<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruleta de Medicamentos Hospitalarios</title>
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --light: #f3f4f6;
      --dark: #1e293b;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
      margin: 0;
      padding: 20px 10px;
      min-height: 100vh;
      color: var(--dark);
      text-align: center;
    }
    h1 {
      color: #1d4ed8;
      margin: 10px 0 4px;
      font-size: clamp(1.8rem, 6vw, 2.5rem);
    }
    .subtitle { color: #4b5563; margin: 0 0 20px; font-size: 1.1rem; }
    .ruleta-container {
      position: relative;
      width: min(340px, 85vw);
      height: min(340px, 85vw);
      margin: 25px auto;
    }
    .ruleta {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 10px solid var(--dark);
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      position: relative;
      overflow: hidden;
      transition: transform 4.8s cubic-bezier(0.22, 0.61, 0.36, 1);
    }
    .sector {
      position: absolute;
      width: 50%;
      height: 50%;
      transform-origin: 100% 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      clip-path: polygon(0 0, 100% 0, 100% 100%);
    }
    .sector span {
      position: absolute;
      font-size: clamp(12px, 3.5vw, 15px);
      font-weight: 700;
      color: #111827;
      text-shadow: 0 1px 3px rgba(255,255,255,0.8);
      transform: translate(-50%, -50%) rotate(90deg);
      white-space: nowrap;
      width: 140px;
      text-align: center;
    }
    .flecha {
      width: 0; height: 0;
      border-left: 22px solid transparent;
      border-right: 22px solid transparent;
      border-bottom: 48px solid #dc2626;
      position: absolute;
      top: -38px;
      left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 4px 8px #0004);
      z-index: 5;
    }
    .controls { margin: 20px 0; }
    button {
      padding: 12px 28px;
      font-size: 1.05rem;
      font-weight: 600;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.22s;
      margin: 8px 4px;
    }
    .btn-primary   { background: var(--primary); color: white; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
    .btn-success   { background: var(--success); color: white; }
    .btn-danger    { background: var(--danger); color: white; }
    .pregunta-container {
      margin: 20px auto;
      max-width: 720px;
      background: white;
      border-radius: 16px;
      padding: 24px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      display: none;
    }
    .progreso { font-weight: bold; color: #4b5563; margin-bottom: 12px; }
    .opcion {
      background: var(--light);
      padding: 16px 20px;
      margin: 10px auto;
      max-width: 540px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.18s;
      font-size: 1.05rem;
      border: 1px solid #d1d5db;
    }
    .opcion:hover { background: #e5e7eb; transform: translateY(-1px); }
    .correcta { background: #d1fae5 !important; border-color: #10b981; font-weight: 600; }
    .incorrecta { background: #fee2e2 !important; border-color: #ef4444; }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-content {
      background: white;
      padding: 28px 24px;
      border-radius: 16px;
      max-width: 90%;
      width: 420px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      text-align: center;
    }
    .modal-content h2 { margin: 0 0 16px; color: var(--dark); }
  </style>
</head>
<body>

<h1>Ruleta de Medicamentos Hospitalarios</h1>
<p class="subtitle">Familia farmacológica y función principal</p>

<div class="ruleta-container">
  <div class="flecha"></div>
  <div class="ruleta" id="ruleta"></div>
</div>

<div class="controls">
  <button id="btnGirar" class="btn-primary">Girar ruleta</button>
</div>

<div class="pregunta-container" id="zonaPregunta">
  <div class="progreso" id="progreso"></div>
  <h2 id="textoPregunta"></h2>
  <div id="opciones"></div>
  <div style="margin-top: 24px;">
    <button id="btnSiguiente" class="btn-primary" style="display:none;">Siguiente pregunta</button>
  </div>
</div>

<div class="modal" id="modalFinTema">
  <div class="modal-content">
    <h2 id="tituloFin"></h2>
    <p id="textoFin"></p>
    <button class="btn-primary" onclick="cerrarModalYContinuar()">Girar de nuevo</button>
  </div>
</div>

<!-- Sonidos (archivos públicos gratuitos - puedes cambiarlos por archivos propios en tu repo) -->
<audio id="soundSpin" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1938.mp3" type="audio/mpeg">
</audio>
<audio id="soundCorrect" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
</audio>
<audio id="soundIncorrect" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
</audio>

<script>
// ────────────────────────────────────────────── Datos ──────────────────────────────────────────────
const temas = [
  "Analgésicos", "Antibióticos", "Cardiovasculares",
  "Endocrinos", "Gastrointestinales", "Respiratorios"
];

const bancoPreguntas = {
  "Analgésicos": [
    { pregunta: "¿A qué familia pertenece el paracetamol?", opciones: ["Analgésico-antipirético", "Antibiótico", "Corticoide"], correcta: 0 },
    { pregunta: "Función principal de la morfina:", opciones: ["Analgésico opioide potente", "Antiinflamatorio", "Antipirético"], correcta: 0 },
    { pregunta: "El tramadol es:", opciones: ["Analgésico opioide", "Anticoagulante", "Diurético"], correcta: 0 },
    { pregunta: "El metamizol sódico se usa principalmente como:", opciones: ["Analgésico y antipirético", "Antiinflamatorio esteroideo", "Opioide fuerte"], correcta: 0 }
  ],
  "Antibióticos": [
    { pregunta: "La ceftriaxona pertenece a:", opciones: ["Cefalosporinas 3ª gen", "Macrólidos", "Aminoglucósidos"], correcta: 0 },
    { pregunta: "El metronidazol es eficaz contra:", opciones: ["Bacterias anaerobias y protozoarios", "Virus", "Hongos"], correcta: 0 },
    { pregunta: "La amoxicilina es un:", opciones: ["Betalactámico (penicilina)", "Quinolona", "Antifúngico"], correcta: 0 }
  ],
  "Cardiovasculares": [
    { pregunta: "La furosemida es un:", opciones: ["Diurético de asa", "IECA", "Betabloqueador"], correcta: 0 },
    { pregunta: "La adrenalina se usa principalmente para:", opciones: ["Emergencias y paro cardiorrespiratorio", "Hipertensión crónica", "Dolor leve"], correcta: 0 },
    { pregunta: "La noradrenalina actúa como:", opciones: ["Vasopresor potente", "Analgésico", "Sedante"], correcta: 0 }
  ],
  "Endocrinos": [
    { pregunta: "La insulina NPH es:", opciones: ["Acción intermedia", "Acción rápida", "Acción ultralenta"], correcta: 0 },
    { pregunta: "La metformina se usa en:", opciones: ["Diabetes tipo 2", "Hipotiroidismo", "Hipertensión"], correcta: 0 },
    { pregunta: "La levotiroxina reemplaza:", opciones: ["Hormona tiroidea (T4)", "Insulina", "Cortisol"], correcta: 0 }
  ],
  "Gastrointestinales": [
    { pregunta: "El omeprazol es un:", opciones: ["Inhibidor de bomba de protones", "Antiemético", "Laxante"], correcta: 0 },
    { pregunta: "La metoclopramida se usa como:", opciones: ["Antiemético procinético", "Analgésico", "Antibiótico"], correcta: 0 },
    { pregunta: "La buscapina es:", opciones: ["Antiespasmódico", "Antiinflamatorio", "Anticoagulante"], correcta: 0 }
  ],
  "Respiratorios": [
    { pregunta: "El salbutamol es un:", opciones: ["Broncodilatador β2 agonista", "Antibiótico", "Corticoide"], correcta: 0 },
    { pregunta: "El atrovent actúa como:", opciones: ["Broncodilatador anticolinérgico", "Antihistamínico", "Antitusígeno"], correcta: 0 },
    { pregunta: "La dexametasona es:", opciones: ["Corticosteroide potente", "Analgésico", "Antibiótico"], correcta: 0 }
  ]
};

// ────────────────────────────────────────────── Elementos DOM y estado ──────────────────────────────────────────────
const soundSpin = document.getElementById("soundSpin");
const soundCorrect = document.getElementById("soundCorrect");
const soundIncorrect = document.getElementById("soundIncorrect");

const ruleta = document.getElementById("ruleta");
const zonaPregunta = document.getElementById("zonaPregunta");
const textoPregunta = document.getElementById("textoPregunta");
const opcionesDiv = document.getElementById("opciones");
const btnSiguiente = document.getElementById("btnSiguiente");
const btnGirar = document.getElementById("btnGirar");
const progreso = document.getElementById("progreso");
const modal = document.getElementById("modalFinTema");
const tituloFin = document.getElementById("tituloFin");
const textoFin = document.getElementById("textoFin");

let preguntasTema = [];
let indicePregunta = 0;
let temaActual = "";
let aciertos = 0;
let totalEnTema = 0;
const temasUsadosRecientes = [];
const MAX_RECientes = 2;

const coloresSectores = ["#bfdbfe","#bbf7d0","#fed7aa","#fecdd3","#e9d5ff","#a7f3d0"];

// Crear sectores
temas.forEach((tema, i) => {
  const sector = document.createElement("div");
  sector.className = "sector";
  sector.style.transform = `rotate(${i * (360 / temas.length)}deg)`;
  sector.style.background = coloresSectores[i % coloresSectores.length];
  const span = document.createElement("span");
  span.textContent = tema;
  sector.appendChild(span);
  ruleta.appendChild(sector);
});

// ────────────────────────────────────────────── Funciones auxiliares ──────────────────────────────────────────────
function shuffleArray(arr) {
  const copy = [...arr];
  for (let i = copy.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy;
}

function elegirTemaNoRepetido() {
  let candidatos = temas.filter(t => !temasUsadosRecientes.includes(t));
  if (candidatos.length === 0) {
    temasUsadosRecientes.length = 0;
    candidatos = [...temas];
  }
  const idx = Math.floor(Math.random() * candidatos.length);
  const elegido = candidatos[idx];
  temasUsadosRecientes.push(elegido);
  if (temasUsadosRecientes.length > MAX_RECientes) temasUsadosRecientes.shift();
  return elegido;
}

function mostrarModal(titulo, texto) {
  tituloFin.textContent = titulo;
  textoFin.textContent = texto;
  modal.style.display = "flex";
}

function cerrarModalYContinuar() {
  modal.style.display = "none";
  zonaPregunta.style.display = "none";
  aciertos = 0;
  btnGirar.disabled = false;
}

// ────────────────────────────────────────────── Lógica del juego ──────────────────────────────────────────────
function girarRuleta() {
  btnGirar.disabled = true;
  zonaPregunta.style.display = "none";
  btnSiguiente.style.display = "none";

  soundSpin.currentTime = 0;
  soundSpin.play().catch(() => {}); // Ignorar errores de autoplay en algunos navegadores

  const vueltas = 4 + Math.floor(Math.random() * 5);
  const anguloExtra = Math.random() * 360;
  const rotacionTotal = vueltas * 360 + anguloExtra;

  ruleta.style.transform = `rotate(${rotacionTotal}deg)`;

  setTimeout(() => {
    temaActual = elegirTemaNoRepetido();
    preguntasTema = shuffleArray(bancoPreguntas[temaActual]);
    indicePregunta = 0;
    aciertos = 0;
    totalEnTema = preguntasTema.length;
    mostrarPregunta();
  }, 4800);
}

function mostrarPregunta() {
  if (indicePregunta >= totalEnTema) {
    const porcentaje = Math.round((aciertos / totalEnTema) * 100);
    const mensaje = `Tema "${temaActual}" completado.\nAciertos: ${aciertos} / ${totalEnTema} (${porcentaje}%)`;
    mostrarModal("Fin del tema", mensaje);
    return;
  }

  const p = preguntasTema[indicePregunta];
  textoPregunta.textContent = p.pregunta;
  progreso.textContent = `Pregunta ${indicePregunta + 1} de ${totalEnTema} – ${temaActual}`;

  const opcionesBarajadas = shuffleArray(p.opciones);
  const indiceCorrecto = opcionesBarajadas.indexOf(p.opciones[p.correcta]);

  opcionesDiv.innerHTML = "";
  zonaPregunta.style.display = "block";
  btnSiguiente.style.display = "none";

  opcionesBarajadas.forEach((op, i) => {
    const div = document.createElement("div");
    div.className = "opcion";
    div.textContent = op;
    div.onclick = () => {
      opcionesDiv.querySelectorAll(".opcion").forEach(o => o.onclick = null);
      if (i === indiceCorrecto) {
        div.classList.add("correcta");
        aciertos++;
        soundCorrect.currentTime = 0;
        soundCorrect.play().catch(() => {});
      } else {
        div.classList.add("incorrecta");
        opcionesDiv.children[indiceCorrecto].classList.add("correcta");
        soundIncorrect.currentTime = 0;
        soundIncorrect.play().catch(() => {});
      }
      btnSiguiente.style.display = "inline-block";
    };
    opcionesDiv.appendChild(div);
  });
}

function siguientePregunta() {
  indicePregunta++;
  mostrarPregunta();
}

// Eventos
btnGirar.onclick = girarRuleta;
btnSiguiente.onclick = siguientePregunta;
</script>
</body>
</html>
