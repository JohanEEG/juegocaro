<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruleta de Medicamentos Hospitalarios</title>
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --light: #f3f4f6;
      --dark: #1e293b;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
      margin: 0;
      padding: 20px 10px;
      min-height: 100vh;
      color: var(--dark);
      text-align: center;
    }
    h1 { color: #1d4ed8; margin: 10px 0 4px; font-size: clamp(1.8rem, 6vw, 2.5rem); }
    .subtitle { color: #4b5563; margin: 0 0 20px; font-size: 1.1rem; }
    .ruleta-container { position: relative; width: min(340px, 85vw); height: min(340px, 85vw); margin: 25px auto; }
    .ruleta { width: 100%; height: 100%; border-radius: 50%; border: 10px solid var(--dark); box-shadow: 0 10px 40px rgba(0,0,0,0.25); position: relative; overflow: hidden; transition: transform 4.8s cubic-bezier(0.22, 0.61, 0.36, 1); }
    .sector { position: absolute; width: 50%; height: 50%; transform-origin: 100% 100%; display: flex; align-items: center; justify-content: center; clip-path: polygon(0 0, 100% 0, 100% 100%); }
    .sector span { position: absolute; font-size: clamp(12px, 3.5vw, 15px); font-weight: 700; color: #111827; text-shadow: 0 1px 3px rgba(255,255,255,0.8); transform: translate(-50%, -50%) rotate(90deg); white-space: nowrap; width: 140px; text-align: center; }
    .flecha { width: 0; height: 0; border-left: 22px solid transparent; border-right: 22px solid transparent; border-bottom: 48px solid #dc2626; position: absolute; top: -38px; left: 50%; transform: translateX(-50%); filter: drop-shadow(0 4px 8px #0004); z-index: 5; }
    .controls { margin: 20px 0; }
    button { padding: 12px 28px; font-size: 1.05rem; font-weight: 600; border: none; border-radius: 999px; cursor: pointer; transition: all 0.22s; margin: 8px 4px; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
    .pregunta-container { margin: 20px auto; max-width: 720px; background: white; border-radius: 16px; padding: 24px 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); display: none; }
    .progreso { font-weight: bold; color: #4b5563; margin-bottom: 12px; }
    .opcion { background: var(--light); padding: 16px 20px; margin: 10px auto; max-width: 540px; border-radius: 12px; cursor: pointer; transition: all 0.18s; font-size: 1.05rem; border: 1px solid #d1d5db; }
    .opcion:hover { background: #e5e7eb; transform: translateY(-1px); }
    .correcta { background: #d1fae5 !important; border-color: #10b981; font-weight: 600; }
    .incorrecta { background: #fee2e2 !important; border-color: #ef4444; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal-content { background: white; padding: 28px 24px; border-radius: 16px; max-width: 90%; width: 420px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); text-align: center; }
    .modal-content h2 { margin: 0 0 16px; color: var(--dark); }
  </style>
</head>
<body>

<h1>Ruleta de Medicamentos Hospitalarios</h1>
<p class="subtitle">Familia farmacológica y función principal</p>

<div class="ruleta-container">
  <div class="flecha"></div>
  <div class="ruleta" id="ruleta"></div>
</div>

<div class="controls">
  <button id="btnGirar" class="btn-primary">Girar ruleta</button>
</div>

<div class="pregunta-container" id="zonaPregunta">
  <div class="progreso" id="progreso"></div>
  <h2 id="textoPregunta"></h2>
  <div id="opciones"></div>
  <div style="margin-top: 24px;">
    <button id="btnSiguiente" class="btn-primary" style="display:none;">Siguiente pregunta</button>
  </div>
</div>

<div class="modal" id="modalFinTema">
  <div class="modal-content">
    <h2 id="tituloFin"></h2>
    <p id="textoFin"></p>
    <button class="btn-primary" onclick="cerrarModalYContinuar()">Girar de nuevo</button>
  </div>
</div>

<!-- Sonidos -->
<audio id="soundSpin" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1938.mp3" type="audio/mpeg">
</audio>
<audio id="soundCorrect" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
</audio>
<audio id="soundIncorrect" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
</audio>

<script>
// ────────────────────────────────────────────── Datos ──────────────────────────────────────────────
const temas = [
  "Analgésicos y Antipiréticos",
  "Antibióticos y Antimicrobianos",
  "Cardiovasculares y Antihipertensivos",
  "Diuréticos",
  "Endocrinos y Antidiabéticos",
  "Gastrointestinales y Antieméticos",
  "Respiratorios y Broncodilatadores",
  "Corticoides y Antiinflamatorios Esteroideos",
  "Vasopresores, Inotrópicos y Emergencias",
  "Anticoagulantes, Sedantes y Otros"
];

const bancoPreguntas = {
  "Analgésicos y Antipiréticos": [
    { pregunta: "¿Familia farmacológica del Paracetamol?", opciones: ["Analgésico y antipirético no opioide", "AINE potente", "Opioide débil", "Corticoide"], correcta: 0 },
    { pregunta: "Función principal del Metamizol sódico:", opciones: ["Analgésico y antipirético (pirazolona)", "Antiinflamatorio esteroideo", "Anticoagulante", "Sedante"], correcta: 0 },
    { pregunta: "El Tramadol pertenece a:", opciones: ["Analgésico opioide débil con efecto SNRI", "AINE", "Corticoide", "Antibiótico"], correcta: 0 },
    { pregunta: "Función principal de la Morfina:", opciones: ["Analgésico opioide fuerte para dolor intenso", "Antipirético central", "Antiinflamatorio", "Diurético"], correcta: 0 },
    { pregunta: "El Ibuprofeno es:", opciones: ["AINE (antiinflamatorio no esteroideo)", "Opioide", "Antipirético puro", "Sedante"], correcta: 0 },
    { pregunta: "Diclofenaco (Voltaren) se clasifica como:", opciones: ["AINE", "Opioide", "Corticoide", "Analgésico central"], correcta: 0 },
    { pregunta: "Aspirina en dosis bajas se usa principalmente como:", opciones: ["Antiagregante plaquetario", "Analgésico potente", "Antibiótico", "Diurético"], correcta: 0 }
  ],
  "Antibióticos y Antimicrobianos": [
    { pregunta: "La Ceftriaxona pertenece a:", opciones: ["Cefalosporina de 3ª generación", "Penicilina", "Macrólido", "Quinolona"], correcta: 0 },
    { pregunta: "Función principal del Metronidazol:", opciones: ["Antibiótico contra anaerobios y antiprotozoario", "Antibiótico de amplio espectro gram+", "Antifúngico", "Antiviral"], correcta: 0 },
    { pregunta: "Amoxicilina es:", opciones: ["Penicilina de amplio espectro", "Cefalosporina", "Fluoroquinolona", "Aminoglucósido"], correcta: 0 },
    { pregunta: "Ciprofloxacina pertenece a:", opciones: ["Fluoroquinolona", "Penicilina", "Cefalosporina", "Macrólido"], correcta: 0 },
    { pregunta: "Ampicilina es:", opciones: ["Penicilina de amplio espectro", "Quinolona", "Tetraciclina", "Sulfonamida"], correcta: 0 },
    { pregunta: "Ceftazidima destaca por cobertura contra:", opciones: ["Pseudomonas aeruginosa", "Anaerobios estrictos", "Gram positivos", "Virus respiratorios"], correcta: 0 },
    { pregunta: "Keflin (Cefalotina) es:", opciones: ["Cefalosporina de 1ª generación", "Cefalosporina de 3ª generación", "Penicilina", "Carbapenem"], correcta: 0 }
  ],
  "Cardiovasculares y Antihipertensivos": [
    { pregunta: "Enalapril pertenece a:", opciones: ["IECA (inhibidor de la ECA)", "ARA-II", "Bloqueador de canales de calcio", "Betabloqueador"], correcta: 0 },
    { pregunta: "Irbesartán es:", opciones: ["ARA-II (antagonista de receptores de angiotensina II)", "IECA", "Diurético de asa", "Vasopresor"], correcta: 0 },
    { pregunta: "Amlodipino se clasifica como:", opciones: ["Bloqueador de canales de calcio dihidropiridínico", "IECA", "Betabloqueador", "Diurético tiazídico"], correcta: 0 },
    { pregunta: "Amiodarona es:", opciones: ["Antiarrítmico clase III", "Vasopresor", "Diurético", "Anticoagulante"], correcta: 0 },
    { pregunta: "Lidocaína se usa principalmente como:", opciones: ["Antiarrítmico clase Ib", "Analgésico opioide", "Sedante", "Antibiótico"], correcta: 0 }
  ],
  "Diuréticos": [
    { pregunta: "Furosemida (IV y oral) es un:", opciones: ["Diurético de asa", "Diurético tiazídico", "Ahorrador de potasio", "Diurético osmótico"], correcta: 0 },
    { pregunta: "Función principal de la Furosemida:", opciones: ["Eliminar sodio y agua en edema e insuficiencia cardíaca", "Reducción crónica de presión arterial", "Ahorro de potasio", "Antihipertensivo central"], correcta: 0 }
  ],
  "Endocrinos y Antidiabéticos": [
    { pregunta: "Levotiroxina se usa para:", opciones: ["Reemplazo hormonal en hipotiroidismo", "Tratamiento de diabetes tipo 2", "Hipertiroidismo", "Insuficiencia suprarrenal"], correcta: 0 },
    { pregunta: "Insulina NPH es de acción:", opciones: ["Intermedia", "Rápida", "Ultralenta", "Oral"], correcta: 0 },
    { pregunta: "Insulina simple (regular) es de acción:", opciones: ["Rápida", "Intermedia", "Larga duración", "Basal"], correcta: 0 },
    { pregunta: "Metformina pertenece a:", opciones: ["Biguanida", "Sulfonilurea", "Insulina inyectable", "Inhibidor de DPP-4"], correcta: 0 }
  ],
  "Gastrointestinales y Antieméticos": [
    { pregunta: "Omeprazol es un:", opciones: ["Inhibidor de bomba de protones (IBP)", "Antiemético procinético", "Antiespasmódico", "Laxante"], correcta: 0 },
    { pregunta: "Metoclopramida (Plasil) se usa principalmente como:", opciones: ["Antiemético y procinético gástrico", "Analgésico", "Antibiótico", "Diurético"], correcta: 0 },
    { pregunta: "Gravol (Dimenhidrinato) es:", opciones: ["Antiemético y antivertiginoso (antihistamínico H1)", "Antiespasmódico", "IBP", "Procinético"], correcta: 0 },
    { pregunta: "Buscapina (Hioscina butilbromuro) es:", opciones: ["Antiespasmódico antimuscarínico", "Antiemético central", "Antiinflamatorio", "Anticoagulante"], correcta: 0 },
    { pregunta: "Loratadina pertenece a:", opciones: ["Antihistamínico H1 de segunda generación", "Corticoide", "Sedante", "Antibiótico"], correcta: 0 }
  ],
  "Respiratorios y Broncodilatadores": [
    { pregunta: "Salbutamol (Albuterol) es:", opciones: ["Beta-2 agonista broncodilatador de acción corta", "Anticolinérgico inhalado", "Corticoide inhalado", "Mucolítico"], correcta: 0 },
    { pregunta: "Atrovent (Ipratropio) es:", opciones: ["Anticolinérgico broncodilatador", "Beta-2 agonista", "Corticoide inhalado", "Antihistamínico"], correcta: 0 }
  ],
  "Corticoides y Antiinflamatorios Esteroideos": [
    { pregunta: "Hidrocortisona es:", opciones: ["Corticoide sistémico (equivalente fisiológico al cortisol)", "AINE", "Antibiótico", "Vasopresor"], correcta: 0 },
    { pregunta: "Prednisolona pertenece a:", opciones: ["Corticoide oral", "AINE", "Opioide", "Antibiótico"], correcta: 0 },
    { pregunta: "Solumedrol (Metilprednisolona) es:", opciones: ["Corticoide intravenoso potente", "Analgésico no opioide", "Diurético", "Sedante"], correcta: 0 },
    { pregunta: "Dexametasona es:", opciones: ["Corticoide sintético de alta potencia", "AINE", "Antibiótico", "Vasopresor"], correcta: 0 }
  ],
  "Vasopresores, Inotrópicos y Emergencias": [
    { pregunta: "Adrenalina (Epinefrina) se usa principalmente en:", opciones: ["Anafilaxia, paro cardiorrespiratorio y broncoespasmo", "Hipertensión crónica", "Dolor moderado", "Sedación prolongada"], correcta: 0 },
    { pregunta: "Dopamina es:", opciones: ["Inotrópico y vasopresor dosis-dependiente", "Sedante benzodiazepínico", "Analgésico opioide", "Diurético de asa"], correcta: 0 },
    { pregunta: "Noradrenalina (Norepinefrina) es:", opciones: ["Vasopresor predominante alfa-adrenérgico", "Broncodilatador beta-2", "Sedante GABAérgico", "Antibiótico"], correcta: 0 },
    { pregunta: "Atropina en emergencias se usa para:", opciones: ["Bradicardia sintomática y como antídoto en intoxicación por organofosforados", "Hipertensión aguda", "Dolor severo", "Sedación en UCI"], correcta: 0 }
  ],
  "Anticoagulantes, Sedantes y Otros": [
    { pregunta: "Enoxaparina es:", opciones: ["Heparina de bajo peso molecular (HBPM)", "Anticoagulante oral directo", "Fibrinolítico", "Antiagregante plaquetario"], correcta: 0 },
    { pregunta: "Heparina no fraccionada se usa principalmente como:", opciones: ["Anticoagulante intravenoso (inhibe trombina y factor Xa)", "Antiagregante plaquetario", "Diurético", "Sedante"], correcta: 0 },
    { pregunta: "Diazepam pertenece a:", opciones: ["Benzodiazepina (ansiolítico, miorrelajante, anticonvulsivo)", "Opioide", "Antipsicótico", "Antidepresivo"], correcta: 0 },
    { pregunta: "Midazolam es:", opciones: ["Benzodiazepina de acción corta para sedación y anestesia", "Opioide fuerte", "Anticonvulsivo no benzodiazepínico", "Barbitúrico"], correcta: 0 }
  ]
};

// ────────────────────────────────────────────── Elementos y estado ──────────────────────────────────────────────
const soundSpin = document.getElementById("soundSpin");
const soundCorrect = document.getElementById("soundCorrect");
const soundIncorrect = document.getElementById("soundIncorrect");

const ruleta = document.getElementById("ruleta");
const zonaPregunta = document.getElementById("zonaPregunta");
const textoPregunta = document.getElementById("textoPregunta");
const opcionesDiv = document.getElementById("opciones");
const btnSiguiente = document.getElementById("btnSiguiente");
const btnGirar = document.getElementById("btnGirar");
const progreso = document.getElementById("progreso");
const modal = document.getElementById("modalFinTema");
const tituloFin = document.getElementById("tituloFin");
const textoFin = document.getElementById("textoFin");

let preguntasTema = [];
let indicePregunta = 0;
let temaActual = "";
let aciertos = 0;
let totalEnTema = 0;
const temasUsadosRecientes = [];
const MAX_RECientes = 2;

const coloresSectores = ["#bfdbfe","#bbf7d0","#fed7aa","#fecdd3","#e9d5ff","#a7f3d0","#c7d2fe","#fed7aa","#fecaca","#ddd6fe"];

// Crear sectores de la ruleta
temas.forEach((tema, i) => {
  const sector = document.createElement("div");
  sector.className = "sector";
  sector.style.transform = `rotate(${i * (360 / temas.length)}deg)`;
  sector.style.background = coloresSectores[i % coloresSectores.length];
  const span = document.createElement("span");
  span.textContent = tema;
  sector.appendChild(span);
  ruleta.appendChild(sector);
});

// ────────────────────────────────────────────── Funciones auxiliares ──────────────────────────────────────────────
function shuffleArray(arr) {
  const copy = [...arr];
  for (let i = copy.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy;
}

function elegirTemaNoRepetido() {
  let candidatos = temas.filter(t => !temasUsadosRecientes.includes(t));
  if (candidatos.length === 0) {
    temasUsadosRecientes.length = 0;
    candidatos = [...temas];
  }
  const idx = Math.floor(Math.random() * candidatos.length);
  const elegido = candidatos[idx];
  temasUsadosRecientes.push(elegido);
  if (temasUsadosRecientes.length > MAX_RECientes) temasUsadosRecientes.shift();
  return elegido;
}

function mostrarModal(titulo, texto) {
  tituloFin.textContent = titulo;
  textoFin.textContent = texto;
  modal.style.display = "flex";
}

function cerrarModalYContinuar() {
  modal.style.display = "none";
  zonaPregunta.style.display = "none";
  aciertos = 0;
  btnGirar.disabled = false;
}

// ────────────────────────────────────────────── Lógica del juego ──────────────────────────────────────────────
function girarRuleta() {
  btnGirar.disabled = true;
  zonaPregunta.style.display = "none";
  btnSiguiente.style.display = "none";

  soundSpin.currentTime = 0;
  soundSpin.play().catch(() => {});

  const vueltas = 4 + Math.floor(Math.random() * 5);
  const anguloExtra = Math.random() * 360;
  const rotacionTotal = vueltas * 360 + anguloExtra;

  ruleta.style.transform = `rotate(${rotacionTotal}deg)`;

  setTimeout(() => {
    temaActual = elegirTemaNoRepetido();
    preguntasTema = shuffleArray(bancoPreguntas[temaActual]);
    indicePregunta = 0;
    aciertos = 0;
    totalEnTema = preguntasTema.length;
    mostrarPregunta();
  }, 4800);
}

function mostrarPregunta() {
  if (indicePregunta >= totalEnTema) {
    const porcentaje = Math.round((aciertos / totalEnTema) * 100);
    const mensaje = `Tema "${temaActual}" completado.\nAciertos: ${aciertos} de ${totalEnTema} (${porcentaje}%)`;
    mostrarModal("Fin del tema", mensaje);
    return;
  }

  const p = preguntasTema[indicePregunta];
  textoPregunta.textContent = p.pregunta;
  progreso.textContent = `Pregunta ${indicePregunta + 1} de ${totalEnTema} – ${temaActual}`;

  const opcionesBarajadas = shuffleArray(p.opciones);
  const indiceCorrecto = opcionesBarajadas.indexOf(p.opciones[p.correcta]);

  opcionesDiv.innerHTML = "";
  zonaPregunta.style.display = "block";
  btnSiguiente.style.display = "none";

  opcionesBarajadas.forEach((op, i) => {
    const div = document.createElement("div");
    div.className = "opcion";
    div.textContent = op;
    div.onclick = () => {
      opcionesDiv.querySelectorAll(".opcion").forEach(o => o.onclick = null);
      if (i === indiceCorrecto) {
        div.classList.add("correcta");
        aciertos++;
        soundCorrect.currentTime = 0;
        soundCorrect.play().catch(() => {});
      } else {
        div.classList.add("incorrecta");
        opcionesDiv.children[indiceCorrecto].classList.add("correcta");
        soundIncorrect.currentTime = 0;
        soundIncorrect.play().catch(() => {});
      }
      btnSiguiente.style.display = "inline-block";
    };
    opcionesDiv.appendChild(div);
  });
}

function siguientePregunta() {
  indicePregunta++;
  mostrarPregunta();
}

// ────────────────────────────────────────────── Eventos ──────────────────────────────────────────────
btnGirar.onclick = girarRuleta;
btnSiguiente.onclick = siguientePregunta;
</script>
</body>
</html>
